<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magento.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magento.com for more information.
 *
 * @category    design
 * @package     rwd_default
 * @copyright   Copyright (c) 2006-2017 X.commerce, Inc. and affiliates (http://www.magento.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>
<div class="block block-subscribe block-slide-newsletter-left" id="blockNewsletter">

    <div class="contenitore-newsletter">
        <form action="<?php echo $this->getFormActionUrl() ?>" method="post" id="newsletter-validate-detail-popup">
            <div class="block-content">

                <div class="popup-text-newsletter">
                    <p><strong><?php echo $this->__('Ottieni lo sconto del 5%'); ?></strong></p>
                    <?php echo $this->__('<span>e ricevi tutte le nostre promozioni!</span>'); ?>
                </div>       
                <div class="input-box">
                   <input type="email" autocapitalize="off" autocorrect="off" spellcheck="false" name="email" id="newsletterPopup" title="<?php echo Mage::helper('core')->quoteEscape($this->__('Inserisci la tua e-mail')) ?>" placeholder="<?php echo $this->quoteEscape($this->__('Inserisci la tua e-mail')) ?>" class="input-text required-entry validate-email" />
                    <input name="mail2" id="mail2Popup" title="" value="" class="input-text" type="hidden" />
                </div>
                <div class="privacy-newsletter">
                    <input class="checkbox required-entry checkbox-newsletter" id="inputPrivacyPopup" title="<?php echo $this->__('Ho letto e accetto la Privacy Policy'); ?>" type="checkbox" name="Privacy" value="on" required="required">
                    <label class="required lable-privacy" for="privacy"><?php echo $this->__('Ho letto e accetto la'); ?> <a target="_blank" href="https://www.iubenda.com/privacy-policy/86406203"><?php echo $this->__('Privacy Policy'); ?></a></label>
                </div>
                <div class="subscribe-bottom-popup">
                    <button id="newsletterBtn" type="submit" title="<?php echo Mage::helper('core')->quoteEscape($this->__('Subscribe')) ?>" class="bottone-iscrizione"><span><span><?php echo $this->__('Subscribe') ?></span></span></button>
                </div>
            </div>
        </form>

        <a href="#0" class="close-newsletter img-replace">Close</a>
        <script type="text/javascript">
            //<![CDATA[
            var newsletterSubscriberFormDetail = new VarienForm('newsletter-validate-detail-popup');
            //]]>
        </script>
    </div>
</div>

<script type="text/javascript">
(function(){
    var wait = 5; // wait X second then run animation
    function createCookie(name,value,days) {
        var expires = "";
        if (days) {
            var date = new Date();
            date.setTime(date.getTime() + (days*24*60*60*1000));
            expires = "; expires=" + date.toUTCString();
        }
        document.cookie = name + "=" + value + expires + "; path=/";
    }
    function readCookie(name) {
        var nameEQ = name + "=";
        var ca = document.cookie.split(';');
        for(var i=0;i < ca.length;i++) {
            var c = ca[i];
            while (c.charAt(0)==' ') c = c.substring(1,c.length);
            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
        }
        return null;
    }
    function openAnimation(){
        jQuery('#blockNewsletter').addClass('is-visible');
    }
    jQuery(document).ready(function($){
        jQuery('.close-newsletter').on('click', function(event){
            jQuery('#blockNewsletter').removeClass('is-visible').delay(1000).css("display","none");
            createCookie('newsletter','y',1);
        });

        jQuery('#newsletterBtn').on('click', function(event){
            createCookie('newsletter','y',365);
        });

        if(readCookie('newsletter')==null){
            setTimeout(function(){ openAnimation(); }, wait*1000);
        }else{
            jQuery('#blockNewsletter').css("display","none");
        }
    });
})();
</script>